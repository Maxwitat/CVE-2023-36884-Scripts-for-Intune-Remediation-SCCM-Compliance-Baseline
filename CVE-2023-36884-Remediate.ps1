# Mitigation of Office vulneribility, https://msrc.microsoft.com/update-guide/vulnerability/CVE-2023-36884
# Script is provided AS-IS without any warranty

function Test-RegistryValue {
    param (
        [parameter(Mandatory = $true)][ValidateNotNullOrEmpty()][string]$Path,
        [parameter(Mandatory = $true)][ValidateNotNullOrEmpty()][string]$Value        
    )
    try {
        $Values = Get-ItemProperty -Path $Path | select-object -ExpandProperty $Value -ErrorAction Stop 
        if ($Values) {
            $true
        }
        else {
            $false
        }
         
    }
    catch {
        $false
    }
}

$key = "HKLM:\SOFTWARE\Policies\Microsoft\Internet Explorer\Main\FeatureControl\FEATURE_BLOCK_CROSS_PROTOCOL_FILE_NAVIGATION"

if(!(Test-Path $key))
{
    New-Item -Path $key -Force
}
    
if(!(Test-RegistryValue -Path $key -Value Graph.exe)){
    New-ItemProperty -Path $key -Name Graph.exe -Value 1 -Force
}
if(!(Test-RegistryValue -Path $key -Value MSAccess.exe)){
    New-ItemProperty -Path $key -Name MSAccess.exe -Value 1 -Force
}
if(!(Test-RegistryValue -Path $key -Value MSPub.exe)){
    New-ItemProperty -Path $key -Name MSPub.exe -Value 1 -Force
}
if(!(Test-RegistryValue -Path $key -Value PowerPnt.exe)){
    New-ItemProperty -Path $key -Name PowerPnt.exe -Value 1 -Force
}
if(!(Test-RegistryValue -Path $key -Value Visio.exe)){
    New-ItemProperty -Path $key -Name Visio.exe -Value 1 -Force
}
if(!(Test-RegistryValue -Path $key -Value WinProj.exe)){
    New-ItemProperty -Path $key -Name WinProj.exe -Value 1 -Force
}
if(!(Test-RegistryValue -Path $key -Value WinWord.exe)){
    New-ItemProperty -Path $key -Name WinWord.exe -Value 1 -Force
}
if(!(Test-RegistryValue -Path $key -Value WordPad.exe)){
    New-ItemProperty -Path $key -Name WordPad.exe -Value 1 -Force
}
